services:
  gateway:
    build: .
    container_name: openclaw_safe
    restart: unless-stopped

    dns:
      - 1.1.1.1
      - 8.8.8.8

    # SECURITY: Standard Bridge Network (No host access)
    network_mode: bridge

    # PERFORMANCE: Give Chrome enough memory to not crash
    shm_size: "2gb"

    # SECURITY: Allow Chrome syscalls without giving full root privileges
    security_opt:
      - seccomp=unconfined

    volumes:
      # Map the CONFIG folder (so settings persist)
      - ./config:/home/node/.openclaw

      # Map the WORKSPACE (where the agent writes files)
      - ./config/openclaw.json:/home/node/.openclaw/openclaw.json:ro
      - ./workspace:/home/node/.openclaw/workspace

    env_file:
      - .env

    environment:
      # Pass keys securely
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_USER_ID=${TELEGRAM_USER_ID}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium
      - PUPPETEER_ARGS=--no-sandbox --disable-setuid-sandbox --disable-dev-shm-usage --disable-gpu --disable-software-rasterizer --disable-dbus --mute-audio --no-first-run --disable-background-networking --disable-features=VizDisplayCompositor,Translate,BackForwardCache --disable-extensions
      - BROWSER_ARGS=--no-sandbox
      - DBUS_SESSION_BUS_ADDRESS=/dev/null

    user: "1000:1000"
